<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Spiking</title>
</head><body>&nbsp; &nbsp; &nbsp; &nbsp; <b>Spiking</b><br/>
<br/>
<br/>
First of all, set the Real-Time Protection down if you haven't done it already:<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\1.png" /><br/>
<img src="1.png" /><br/>
<br/>
<br/>
<br/>
<b>DISCLAIMER: RUN ALL AS AN ADMINISTRATOR!!!</b><br/>
<br/>
<br/>
The first step is to run the VulnServer (as an administrator):<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\2.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\3.png" /><br/>
<img src="1 2.png" /><br/>
<img src="2.png" /><br/>
<br/>
<br/>
<br/>
Now, run Immunity Debugger (as an administrator):<br/>
We will attach to the VulnServer and run (you will see “Running” into the bot right corner)<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\4.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\5.png" /><br/>
<img src="1 3.png" /><br/>
<br/>
<img src="2 2.png" /><br/>
<br/>
<br/>
<br/>
Now, back at the <b>Attacker Machine (Kali)</b>, connect to the VulnServer (it run on port 9999):<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\6.png" /><br/>
<img src="1 4.png" /><br/>
<br/>
<br/>
<br/>
We are going to do some Spiking: throwing a bunch of chars to see if we can buffer overflow <br/>
We will try one command at time.<br/>
As an example, we want to see if the <b>TRUN</b>&nbsp;command is vulnerable to buffer overflow <br/>
<br/>
<br/>
For spiking, we will use a tool called <b>generic_send_tcp</b>:<br/>
Close the connection with VulnServer (use <b>EXIT</b>&nbsp;command)<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\7.png" /><br/>
<img src="1 5.png" /><br/>
<br/>
<br/>
<br/>
We will need a spike script (for the 2 variables: set the value at 0)<br/>
We can use a <b>stats.spk</b>&nbsp;script<br/>
In this case, we will start with the <b>STATS</b>&nbsp;command<br/>
<b>stats.spk:<br/>
</b><br/>
<span style="color: #ffdd00">s_readline()</span><span style="color: #ff9d00">;</span><br/>
s_string<span style="color: #ff9d00">(</span><span style="color: #3ad900">"STATS "</span><span style="color: #ff9d00">);</span><br/>
s_string_variable<span style="color: #ff9d00">(</span><span style="color: #3ad900">"0"</span><span style="color: #ff9d00">);</span><br/>
<br/>
<br/>
We are trying but seems to be not vulnerable:<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\8.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\9.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\10.png" /><br/>
<img src="1 6.png" /><br/>
<img src="2 3.png" /><br/>
<img src="3.png" /><br/>
<br/>
<br/>
<br/>
Now we are trying the <b>TRUN</b>&nbsp;argument:<br/>
<b>trun.spk</b>&nbsp;<br/>
<span style="color: #ffdd00">s_readline()</span><span style="color: #ff9d00">;</span><br/>
s_string<span style="color: #ff9d00">(</span><span style="color: #3ad900">"TRUN "</span><span style="color: #ff9d00">);</span><br/>
s_string_variable<span style="color: #ff9d00">(</span><span style="color: #3ad900">"0"</span><span style="color: #ff9d00">);</span><br/>
<br/>
<br/>
Run the commands:<br/>
We will see the Immunity Debugger Paused and an “Access Violation” on the Server<br/>
(The server is crashed!!!)<br/>
<img src="1 7.png" /><br/>
<img src="2 4.png" /><br/>
<br/>
<img src="3 2.png" /><br/>
<img src="4.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\11.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\12.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\13.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\14.png" /><br/>
<br/>
<br/>
If you see into the top right of the Immunity Debugger we can see a lot of information:<br/>
The <b>EBP</b>&nbsp;and <b>EIP</b>&nbsp;are overwritten with <b>414141</b>&nbsp;(Are 4 A, if you see into the bot right corner)<br/>
We got it: the EIP is overwritten and we can get it to point wherever we want to!</body></html>