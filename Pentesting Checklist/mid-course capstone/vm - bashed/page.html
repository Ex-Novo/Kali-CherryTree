<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>VM - Bashed</title>
</head><body>&nbsp; &nbsp; &nbsp; &nbsp; <b>Walktrough - Bashed</b><br/>
<br/>
<br/>
<i><b>Windows Machine</b></i><br/>
<br/>
First, start a "<b>nmap -T4 -A -p- IPADDRESS"</b><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\1.png" /><br/>
<img src="1.png" /><br/>
<br/>
We can see only a port 80 open <b>(Apache httpd 2.4.18)</b>&nbsp;and probably an <b>Ubuntu</b>&nbsp;machine<br/>
<br/>
<br/>
<b>################################################################</b><br/>
<br/>
<br/>
<b>Web Server</b><br/>
<br/>
We can search for exploits, just to know if there are some for that Apache version:<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\2.png" /><br/>
<img src="1 2.png" /><br/>
<br/>
<br/>
First thing to do: check the website<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\3.png" /><br/>
<img src="1 3.png" /><br/>
<br/>
<br/>
... and search more about<b>&nbsp;phpbash:</b><br/>
<a href="https://github.com/Arrexel/phpbash
">https://github.com/Arrexel/phpbash<br/>
</a><img src="1 4.png" /><br/>
<br/>
<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\4.png" /><br/>
<br/>
<br/>
We can use <b>Dirbuster</b>&nbsp;to search trough directories:<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\5.png" /><br/>
<img src="1 5.png" /><br/>
<br/>
<br/>
<br/>
Dirbuster show us the <b>“dev”</b>&nbsp;folder: we can try to access it<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\6.png" /><br/>
<img src="1 6.png" /><br/>
<br/>
<br/>
<br/>
We can access <b>phpbash.php</b>&nbsp;page: it is like a bash shell!!!<br/>
You can even send some commands to the page as a shell<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\7.png" /><br/>
<img src="1 7.png" /><br/>
<br/>
<br/>
<br/>
We are www-data here, so we are already somehow into the machine.<br/>
But we can try to get the root access.<br/>
<br/>
<br/>
First off, we can use <b>“sudo -l”</b>&nbsp;to see what we can do:<br/>
we can switch to another user called <b>scriptmanager</b><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\8.png" /><br/>
<img src="1 8.png" /><br/>
<br/>
<br/>
<br/>
Unfortunaly, we can't create a shell<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\9.png" /><br/>
<img src="1 9.png" /><br/>
<br/>
<br/>
<br/>
Idea: we can upload something malicious to get an exploit,<br/>
We can try to get a <b>php reverse shell</b><br/>
<a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">http://pentestmonkey.net/tools/web-shells/php-reverse-shell</a><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\10.png" /><br/>
<img src="1 10.png" /><br/>
<br/>
<br/>
<br/>
Reading the instructions, we need to change some setting<br/>
and have something to listen to (like a netcat listener)<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\11.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\12.png" /><br/>
<img src="1 11.png" /><br/>
<img src="2.png" /><br/>
<br/>
<br/>
<br/>
We need to upload the file on the machine (We can use many methods, like <b>SimpleHTTPServer</b>)<br/>
On your machine <b>(Hosting the php reverse shell)</b>:<br/>
<img src="1 12.png" /><br/>
<br/>
<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\13.png" /><br/>
On enemy <b>phpbash</b>:<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\14.png" /><br/>
<img src="1 13.png" /><br/>
<br/>
<br/>
<br/>
If we go to the URL, we can gain the shell!!<br/>
<img src="1 14.png" /><br/>
<br/>
<img src="2 2.png" /><br/>
<br/>
<img src="3.png" /><br/>
<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\15.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\16.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\17.png" /><br/>
<br/>
We are still the (www-data) user here:<br/>
We can't access the tty (the software part that output commands to the terminal)<br/>
We need to improve our situation with... <b>TTY ESCAPE COMMANDS!!!</b><br/>
<a href="https://netsec.ws/?p=337">https://netsec.ws/?p=337<br/>
</a><img src="1 15.png" /><a href="https://netsec.ws/?p=337"><br/>
</a><a href="https://netsec.ws/?p=337"><br/>
</a><img src="2 3.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\18.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\19.png" /><br/>
<br/>
<br/>
Let's try some methods:<br/>
Python worked!!! (But we changed form <b>/bin/sh</b>&nbsp;to <b>/bin/bash</b>)<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\20.png" /><br/>
<img src="1 16.png" /><br/>
<br/>
Better see what we can do over there.<br/>
The attempt to log as a scriptmanager failed (we are trying a blank password)<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\21.png" /><br/>
<img src="1 17.png" /><br/>
<br/>
<br/>
<br/>
We can try something smarter:<br/>
Execute a command as a <b>scriptmanager</b>&nbsp;like /bin/bash and login as him!!!<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\22.png" /><br/>
<img src="1 18.png" /><br/>
<br/>
<br/>
<br/>
We are logged as <b>scriptmanager</b>&nbsp;now!!<br/>
But we have no sudo access, so no big deal<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\23.png" /><br/>
<img src="1 19.png" /><br/>
<br/>
<br/>
<br/>
If we searc htrough folders, we can see an unusual <b>“script”</b>&nbsp;folder into / folder<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\24.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\25.png" /><br/>
<img src="1 20.png" /><br/>
<br/>
<img src="2 4.png" /><br/>
<br/>
<br/>
<br/>
<br/>
We can see an interesting thing here:<br/>
The <b>“test.txt”</b>&nbsp;file is written at <b>13:33</b>&nbsp;(the date when I went into the folder) and it is <b>root:root</b>&nbsp;<br/>
by the python <b>“test.py”</b>&nbsp;file every minute<br/>
<br/>
Our idea can be: overwrite the python file with a reverse shell!!!<br/>
<a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet<br/>
<img src="1 21.png" /><br/>
<br/>
</a><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\26.png" /><br/>
REMEMBER: SUBSTITUTE <b>“/bin/sh”</b>&nbsp;with <b>"/bin/bash"</b><br/>
&nbsp;CHANGE THE S.CONNECT VALUES <b>WITH YOUR IP ADDRESS</b>&nbsp;AND A <b>NEW PORT</b>&nbsp;(E.G 2345)<br/>
<img src="1 22.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\27.png" /><br/>
<br/>
<br/>
Copy the green part (<b>changed with right values</b>), paste into the test.py file and start a listener<br/>
(To change the test.py file you can use <b>nano</b>&nbsp;if it is available or the <b>SimpleHTTPServer + wget</b>&nbsp;method)<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\28.png" /><br/>
<img src="1 23.png" /><br/>
<br/>
Wait a minute and....<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\29.png" /><br/>
<img src="2 5.png" /><br/>
<br/>
</body></html>