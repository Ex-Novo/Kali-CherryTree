<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>VM - Devel</title>
</head><body>&nbsp; &nbsp; &nbsp; &nbsp; <b>Walktrough - Devel</b><br/>
<br/>
<br/>
<b><i>Windows Machine</i></b><br/>
<br/>
First, start a "<b>nmap -T4 -A -p- IPADDRESS"</b><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\1.png" /><br/>
<img src="1.png" /><br/>
<br/>
We have a <b>FTP (with Anonymous Login)</b>&nbsp;and a <b>Microsoft IIS httpd 7.5</b>&nbsp;<b>(Web Server)</b><br/>
<br/>
<br/>
<b>################################################################</b><br/>
<br/>
<br/>
<b>PORT 80 (WEB): MICROSOFT IIS</b>&nbsp;<br/>
<br/>
<br/>
First thing we can do is to check the Web Server:<br/>
We see a default web page<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\2.png" /><br/>
<img src="1 2.png" /><br/>
<br/>
<br/>
If we see things like that, we can try to enumerate more with Directory tools <b>(dirbuster)</b>:<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\3.png" /><br/>
<img src="1 3.png" /><br/>
<br/>
<br/>
Let dirbuster scan for you.<br/>
NOW, we can see trough nmap scan, we see that there is a <b>welcome.png</b>&nbsp;file:<br/>
This is the same file used for default page!!!<br/>
<b>We can change it (or the default page) to let the server execute something else!!!</b><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\4.png" /><br/>
<img src="1 4.png" /><br/>
<br/>
<br/>
Let's try to log with <b>FTP (anonymous)</b>:<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\5.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\6.png" /><br/>
<img src="1 5.png" /><br/>
<br/>
<img src="2.png" /><br/>
<br/>
We can put files with<b>&nbsp;“put"</b>&nbsp;command:<br/>
As an example, we put the <b>“dog.jpg”</b>&nbsp;file on the FTP server<br/>
<img src="1 6.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\7.png" /><br/>
<br/>
<br/>
What is the whole point: FTP is not a problem (to put files on)<br/>
But... if we can execute them somehow, that will be a problem (for them)!!!<br/>
<br/>
<br/>
In this case, we can create an exploit to be executed on the machine:<br/>
We will use <b>MSFVenom</b><br/>
For easy cheatsheets: <b>msfvenom cheat sheet</b>&nbsp;on Google<br/>
<a href="https://netsec.ws/?p=331">https://netsec.ws/?p=331<br/>
</a><img src="1 7.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\8.png" /><br/>
<br/>
<br/>
(With <b>-a</b>&nbsp;you can decide the architecture: if in case x64/x86 doesn't work, try switching with the other)<br/>
<img src="1 8.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\9.png" /><br/>
<br/>
<br/>
Now, open an handler to listen this future payload<br/>
<img src="1 9.png" /><br/>
<br/>
<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\10.png" /><br/>
It is litteraly emtpy. We need to set a payload<b>&nbsp;(the same choosen in MSFVenom)</b><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\11.png" /><br/>
<img src="1 10.png" /><br/>
<br/>
Run the handler listener:<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\12.png" /><br/>
<img src="1 11.png" /><br/>
<br/>
<br/>
<br/>
Now, put the exploit file on FTP server:<br/>
You can use <b>“put” for ASCII files</b>&nbsp;or <b>“binary”</b>&nbsp;<b>for binary files</b><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\13.png" /><br/>
<img src="1 12.png" /><br/>
<br/>
<br/>
... and open the file using the Web Server<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\14.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\15.png" /><br/>
<img src="1 13.png" /><br/>
<img src="2 2.png" /><br/>
<br/>
<br/>
And we are in!!!<br/>
But not a <b>NT AUTHORITY\SYSTEM<br/>
</b><img src="1 14.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\16.png" /><br/>
<br/>
<br/>
We can try to use <b>getsystem</b>&nbsp;to get a privilege escalation:<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\17.png" /><br/>
<img src="1 15.png" /><br/>
<br/>
<br/>
Crap. Didn't work.<br/>
Background our session and try a POST-EXPLOITATION module:<br/>
<b>THE SUGGESTER<br/>
</b><img src="1 16.png" /><br/>
<br/>
<img src="2 3.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\18.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\19.png" /><br/>
<br/>
<br/>
The suggester will suggest us some post exploitation modules to use:<br/>
If one doesn't work, try the others.<br/>
<img src="1 17.png" /><br/>
<br/>
<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\20.png" /><br/>
We will try to use the <b>kitrap0d</b>&nbsp;<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\21.png" /><br/>
<img src="1 18.png" /><br/>
<br/>
<br/>
Run <b>kitrap0d</b>:<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\22.png" /><br/>
<img src="1 19.png" /><br/>
<br/>
<br/>
No session created.<br/>
But now, if we use <b>“options”</b>&nbsp;we can see that we have a payload with a wrong IP address!!!<br/>
Let's change and try again<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\23.png" /><br/>
<img src="1 20.png" /><br/>
<br/>
<br/>
Run (again) <b>kitrap0d</b>&nbsp;with the correct IP Address<br/>
(CHANGE THE PORT NUMBER TO SOMETHING NOT USED E.G. 4445)<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\24.png" /><br/>
<img src="1 21.png" /><br/>
<br/>
<br/>
In this case, you need to do the exploit again:<br/>
1) Set up a listener handler with Metasploit (on 4444 in this case)<br/>
2) Go to URL and execute the file (to let the exploit to connect to us)<br/>
3) Set the session in background<br/>
4) Set <b>kitrap0d</b>&nbsp;with the NEW SESSION NUMBER<br/>
5) Run <b>kitrap0d</b><br/>
<br/>
<br/>
If all works, you should have a response on the handler like this one:<br/>
<img src="1 22.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmpylrjhj\25.png" /></body></html>